"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Main=function(){function t(){_classCallCheck(this,t),this.canvas=document.getElementById("main"),this.input=document.getElementById("input"),this.canvas.width=449,this.canvas.height=449,this.ctx=this.canvas.getContext("2d"),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseout",this.onMouseOut.bind(this)),this.initialize()}return _createClass(t,[{key:"initialize",value:function(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,449,449),this.ctx.lineWidth=1,this.ctx.strokeRect(0,0,449,449),this.ctx.lineWidth=.05;for(var t=0;t<27;t++)this.ctx.beginPath(),this.ctx.moveTo(16*(t+1),0),this.ctx.lineTo(16*(t+1),449),this.ctx.closePath(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,16*(t+1)),this.ctx.lineTo(449,16*(t+1)),this.ctx.closePath(),this.ctx.stroke();this.drawInput(),$("#output td").text("").removeClass("success")}},{key:"onMouseDown",value:function(t){this.canvas.style.cursor="default",this.drawing=!0,this.prev=this.getPosition(t.clientX,t.clientY)}},{key:"onMouseUp",value:function(){this.drawing=!1,this.drawInput()}},{key:"onMouseMove",value:function(t){if(this.drawing){var e=this.getPosition(t.clientX,t.clientY);this.ctx.lineWidth=16,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(this.prev.x,this.prev.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.closePath(),this.prev=e}}},{key:"onMouseOut",value:function(){this.drawing=!1,this.drawInput()}},{key:"getPosition",value:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}},{key:"drawInput",value:function(){var t=this.input.getContext("2d"),e=new Image;e.onload=function(){var i=[],n=document.createElement("canvas").getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,28,28);for(var s=n.getImageData(0,0,28,28).data,a=0;a<28;a++)for(var o=0;o<28;o++){var c=4*(28*a+o);i[28*a+o]=(s[c+0]+s[c+1]+s[c+2])/3,t.fillStyle="rgb("+[s[c+0],s[c+1],s[c+2]].join(",")+")",t.fillRect(5*o,5*a,5,5)}255!==Math.min.apply(Math,i)&&$.ajax({url:"/api/mnist",method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(t){console.log(t);for(var e=0;e<3;e++)$("#output tr").eq(e+1).find("td").eq(0).text(t.results[0][e]);$("#output tr").eq(1).find("td").eq(1).text(t.results[1][0])}})},e.src=this.canvas.toDataURL()}}]),t}();$(function(){var t=new Main;$("#clear").click(function(){t.initialize()})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJNYWluIiwidGhpcyIsImNhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbnB1dCIsIndpZHRoIiwiaGVpZ2h0IiwiY3R4IiwiZ2V0Q29udGV4dCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvbk1vdXNlRG93biIsImJpbmQiLCJvbk1vdXNlVXAiLCJvbk1vdXNlTW92ZSIsIm9uTW91c2VPdXQiLCJpbml0aWFsaXplIiwidmFsdWUiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImxpbmVXaWR0aCIsInN0cm9rZVJlY3QiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZVBhdGgiLCJzdHJva2UiLCJkcmF3SW5wdXQiLCIkIiwidGV4dCIsInJlbW92ZUNsYXNzIiwiZSIsInN0eWxlIiwiY3Vyc29yIiwiZHJhd2luZyIsInByZXYiLCJnZXRQb3NpdGlvbiIsImNsaWVudFgiLCJjbGllbnRZIiwiY3VyciIsImxpbmVDYXAiLCJ4IiwieSIsInJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJsZWZ0IiwidG9wIiwiaW1nIiwiSW1hZ2UiLCJvbmxvYWQiLCJpbnB1dHMiLCJzbWFsbCIsImNyZWF0ZUVsZW1lbnQiLCJkcmF3SW1hZ2UiLCJkYXRhIiwiZ2V0SW1hZ2VEYXRhIiwiaiIsIm4iLCJqb2luIiwiTWF0aCIsIm1pbiIsImFwcGx5IiwiYWpheCIsInVybCIsIm1ldGhvZCIsImNvbnRlbnRUeXBlIiwiSlNPTiIsInN0cmluZ2lmeSIsInN1Y2Nlc3MiLCJjb25zb2xlIiwibG9nIiwiX2kiLCJlcSIsImZpbmQiLCJyZXN1bHRzIiwic3JjIiwidG9EYXRhVVJMIiwibWFpbiIsImNsaWNrIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUlBLFNBQVNBLGlCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxZQUFvQkMsSUFBZ0IsS0FBTSxJQUFJQyxXQUFVLHFDQUZoSCxHQUFJQyxjQUFlLFdBQWMsUUFBU0MsR0FBaUJDLEVBQVFDLEdBQVMsSUFBSyxHQUFJQyxHQUFJLEVBQUdBLEVBQUlELEVBQU1FLE9BQVFELElBQUssQ0FBRSxHQUFJRSxHQUFhSCxFQUFNQyxFQUFJRSxHQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQU9ELEVBQVdFLGNBQWUsRUFBVSxTQUFXRixLQUFZQSxFQUFXRyxVQUFXLEdBQU1DLE9BQU9DLGVBQWVULEVBQVFJLEVBQVdNLElBQUtOLElBQWlCLE1BQU8sVUFBVVIsRUFBYWUsRUFBWUMsR0FBaUosTUFBOUhELElBQVlaLEVBQWlCSCxFQUFZaUIsVUFBV0YsR0FBaUJDLEdBQWFiLEVBQWlCSCxFQUFhZ0IsR0FBcUJoQixNQUs1aEJrQixLQUFPLFdBQ1AsUUFBU0EsS0FDTHBCLGdCQUFnQnFCLEtBQU1ELEdBRXRCQyxLQUFLQyxPQUFTQyxTQUFTQyxlQUFlLFFBQ3RDSCxLQUFLSSxNQUFRRixTQUFTQyxlQUFlLFNBQ3JDSCxLQUFLQyxPQUFPSSxNQUFRLElBQ3BCTCxLQUFLQyxPQUFPSyxPQUFTLElBQ3JCTixLQUFLTyxJQUFNUCxLQUFLQyxPQUFPTyxXQUFXLE1BQ2xDUixLQUFLQyxPQUFPUSxpQkFBaUIsWUFBYVQsS0FBS1UsWUFBWUMsS0FBS1gsT0FDaEVBLEtBQUtDLE9BQU9RLGlCQUFpQixVQUFXVCxLQUFLWSxVQUFVRCxLQUFLWCxPQUM1REEsS0FBS0MsT0FBT1EsaUJBQWlCLFlBQWFULEtBQUthLFlBQVlGLEtBQUtYLE9BQ2hFQSxLQUFLQyxPQUFPUSxpQkFB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QUNqRWpELEVBQUlVLFVBQVksUUFBVW9DLEVBQUtHLEVBQUksR0FBSUgsRUFBS0csRUFBSSxHQUFJSCxFQUFLRyxFQUFJLElBQUlDLEtBQUssS0FBTyxJQUM3RWxELEVBQUlXLFNBQWEsRUFBSnFDLEVBQVcsRUFBSnBFLEVBQU8sRUFBRyxHQUdELE1BQWpDdUUsS0FBS0MsSUFBSUMsTUFBTUYsS0FBTVQsSUFHekJ0QixFQUFFa0MsTUFDRUMsSUFBSyxhQUNMQyxPQUFRLE9BQ1JDLFlBQWEsbUJBQ2JYLEtBQU1ZLEtBQUtDLFVBQVVqQixHQUNyQmtCLFFBQVMsU0FBaUJkLEdBQ3RCZSxRQUFRQyxJQUFJaEIsRUFDWixLQUFLLEdBQUlpQixHQUFLLEVBQUdBLEVBQUssRUFBR0EsSUFDckIzQyxFQUFFLGNBQWM0QyxHQUFHRCxFQUFLLEdBQUdFLEtBQUssTUFBTUQsR0FBRyxHQUFHM0MsS0FBS3lCLEVBQUtvQixRQUFRLEdBQUdILEdBRXJFM0MsR0FBRSxjQUFjNEMsR0FBRyxHQUFHQyxLQUFLLE1BQU1ELEdBQUcsR0FBRzNDLEtBQUt5QixFQUFLb0IsUUFBUSxHQUFHLFFBSXhFM0IsRUFBSTRCLElBQU0xRSxLQUFLQyxPQUFPMEUsZ0JBSXZCNUUsSUFHWDRCLEdBQUUsV0FDRSxHQUFJaUQsR0FBTyxHQUFJN0UsS0FDZjRCLEdBQUUsVUFBVWtELE1BQU0sV0FDZEQsRUFBSzdEIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbi8qIGdsb2JhbCAkICovXG52YXIgTWFpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWFpbik7XG5cbiAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpO1xuICAgICAgICB0aGlzLmlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lucHV0Jyk7XG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gNDQ5OyAvLyAxNiAqIDI4ICsgMVxuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSA0NDk7IC8vIDE2ICogMjggKyAxXG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5vbk1vdXNlRG93bi5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25Nb3VzZVVwLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIHRoaXMub25Nb3VzZU91dC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplKCk7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUNsYXNzKE1haW4sIFt7XG4gICAgICAgIGtleTogJ2luaXRpYWxpemUnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9ICcjRkZGRkZGJztcbiAgICAgICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDAsIDAsIDQ0OSwgNDQ5KTtcbiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgICAgICAgICB0aGlzLmN0eC5zdHJva2VSZWN0KDAsIDAsIDQ0OSwgNDQ5KTtcbiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDAuMDU7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI3OyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5tb3ZlVG8oKGkgKyAxKSAqIDE2LCAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oKGkgKyAxKSAqIDE2LCA0NDkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKDAsIChpICsgMSkgKiAxNik7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKDQ0OSwgKGkgKyAxKSAqIDE2KTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZHJhd0lucHV0KCk7XG4gICAgICAgICAgICAkKCcjb3V0cHV0IHRkJykudGV4dCgnJykucmVtb3ZlQ2xhc3MoJ3N1Y2Nlc3MnKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnb25Nb3VzZURvd24nLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZURvd24oZSkge1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnO1xuICAgICAgICAgICAgdGhpcy5kcmF3aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucHJldiA9IHRoaXMuZ2V0UG9zaXRpb24oZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdvbk1vdXNlVXAnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZVVwKCkge1xuICAgICAgICAgICAgdGhpcy5kcmF3aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmRyYXdJbnB1dCgpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdvbk1vdXNlTW92ZScsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbk1vdXNlTW92ZShlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kcmF3aW5nKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnIgPSB0aGlzLmdldFBvc2l0aW9uKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lV2lkdGggPSAxNjtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lQ2FwID0gJ3JvdW5kJztcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5tb3ZlVG8odGhpcy5wcmV2LngsIHRoaXMucHJldi55KTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oY3Vyci54LCBjdXJyLnkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMucHJldiA9IGN1cnI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ29uTW91c2VPdXQnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZU91dCgpIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5kcmF3SW5wdXQoKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnZ2V0UG9zaXRpb24nLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UG9zaXRpb24oY2xpZW50WCwgY2xpZW50WSkge1xuICAgICAgICAgICAgdmFyIHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgeDogY2xpZW50WCAtIHJlY3QubGVmdCxcbiAgICAgICAgICAgICAgICB5OiBjbGllbnRZIC0gcmVjdC50b3BcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ2RyYXdJbnB1dCcsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3SW5wdXQoKSB7XG4gICAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5pbnB1dC5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5wdXRzID0gW107XG4gICAgICAgICAgICAgICAgdmFyIHNtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgICAgICBzbWFsbC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBpbWcud2lkdGgsIGltZy5oZWlnaHQsIDAsIDAsIDI4LCAyOCk7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBzbWFsbC5nZXRJbWFnZURhdGEoMCwgMCwgMjgsIDI4KS5kYXRhO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IDI4OyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gNCAqIChpICogMjggKyBqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0c1tpICogMjggKyBqXSA9IChkYXRhW24gKyAwXSArIGRhdGFbbiArIDFdICsgZGF0YVtuICsgMl0pIC8gMztcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiKCcgKyBbZGF0YVtuICsgMF0sIGRhdGFbbiArIDFdLCBkYXRhW24gKyAyXV0uam9pbignLCcpICsgJyknO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KGogKiA1LCBpICogNSwgNSwgNSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKE1hdGgubWluLmFwcGx5KE1hdGgsIGlucHV0cykgPT09IDI1NSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9hcGkvbW5pc3QnLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoaW5wdXRzKSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gc3VjY2VzcyhkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCAzOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI291dHB1dCB0cicpLmVxKF9pICsgMSkuZmluZCgndGQnKS5lcSgwKS50ZXh0KGRhdGEucmVzdWx0c1swXVtfaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI291dHB1dCB0cicpLmVxKDEpLmZpbmQoJ3RkJykuZXEoMSkudGV4dChkYXRhLnJlc3VsdHNbMV1bMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaW1nLnNyYyA9IHRoaXMuY2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICAgICB9XG4gICAgfV0pO1xuXG4gICAgcmV0dXJuIE1haW47XG59KCk7XG5cbiQoZnVuY3Rpb24gKCkge1xuICAgIHZhciBtYWluID0gbmV3IE1haW4oKTtcbiAgICAkKCcjY2xlYXInKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIG1haW4uaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSk7Il19
